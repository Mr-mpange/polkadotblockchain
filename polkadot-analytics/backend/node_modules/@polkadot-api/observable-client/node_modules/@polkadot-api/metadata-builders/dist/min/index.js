"use strict";var Y=Object.create;var R=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var re=(e,o)=>{for(var u in o)R(e,u,{get:o[u],enumerable:!0})},q=(e,o,u,l)=>{if(o&&typeof o=="object"||typeof o=="function")for(let c of $(o))!te.call(e,c)&&c!==u&&R(e,c,{get:()=>o[c],enumerable:!(l=Z(o,c))||l.enumerable});return e};var ne=(e,o,u)=>(u=e!=null?Y(ee(e)):{},q(o||!e||!e.__esModule?R(u,"default",{value:e,enumerable:!0}):u,e)),oe=e=>q(R({},"__esModule",{value:!0}),e);var ye={};re(ye,{getChecksumBuilder:()=>me,getDynamicBuilder:()=>se,getLookupFn:()=>A});module.exports=oe(ye);var j=(e,o)=>e.type==="array"&&e.len===o&&e.value.type==="primitive"&&e.value.value==="u8",A=e=>{let o=new Map,u=new Set,l=a=>n=>{let i=o.get(n);if(i)return i;if(u.has(n)){let f={id:n};return o.set(n,f),f}u.add(n);let b=a(n);return i=o.get(n),i?Object.assign(i,b):(i={id:n,...b},o.set(n,i)),u.delete(n),i},c=!0,t=!0,r=l(a=>{let{def:n,path:i,params:b}=e[a];if(n.tag==="composite"){if(n.value.length===0)return{type:"void"};if(n.value.length===1){let s=r(n.value[0].type);return c&&i.at(-1)==="AccountId32"&&j(s,32)?(c=!1,{type:"AccountId32"}):t&&i.at(-1)==="AccountId20"&&j(s,20)?(t=!1,{type:"AccountId20"}):s}let f=!0,d={},p={};return n.value.forEach((s,y)=>{f=f&&!!s.name;let g=s.name||y;d[g]=r(s.type),p[g]=s.docs}),f?{type:"struct",value:d,innerDocs:p}:{type:"tuple",value:Object.values(d),innerDocs:Object.values(p)}}if(n.tag==="variant"){if(i.length===1&&i[0]==="Option"&&b.length===1&&b[0].name==="T"){let p=r(b[0].type);return p.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:p}}if(i.length===1&&i[0]==="Result"&&b.length===2&&b[0].name==="T"&&b[1].name==="E")return{type:"result",value:{ok:r(b[0].type),ko:r(b[1].type)}};if(n.value.length===0)return{type:"void"};let f={},d={};return n.value.forEach(p=>{let s=p.name;if(d[s]=p.docs,p.fields.length===0){f[s]={type:"void",idx:p.index};return}if(p.fields.length===1&&!p.fields[0].name){f[s]={type:"lookupEntry",value:r(p.fields[0].type),idx:p.index};return}let y=!0,g={},v={};if(p.fields.forEach((h,S)=>{y=y&&!!h.name;let L=h.name||S;g[L]=r(h.type),v[L]=h.docs}),y)f[s]={type:"struct",value:g,innerDocs:v,idx:p.index};else{let h=Object.values(g),S=Object.values(v),L=h.every(C=>C.id===h[0].id);f[s]=L&&S.every(C=>C.length===0)?{type:"array",value:h[0],len:h.length,idx:p.index}:{type:"tuple",value:h,innerDocs:S,idx:p.index}}}),{type:"enum",value:f,innerDocs:d}}if(n.tag==="sequence")return{type:"sequence",value:r(n.value)};if(n.tag==="array"){let{len:f}=n.value,d=r(n.value.type);return f===0?{type:"void"}:f===1?d:{type:"array",value:d,len:n.value.len}}if(n.tag==="tuple"){if(n.value.length===0)return{type:"void"};if(n.value.length===1)return r(n.value[0]);let f=n.value.map(s=>r(s)),d=n.value.map(s=>e[s].docs);return f.every(s=>s.id===f[0].id)&&d.every(s=>s.length===0)?{type:"array",value:f[0],len:f.length}:{type:"tuple",value:f,innerDocs:d}}if(n.tag==="primitive")return{type:"primitive",value:n.value.tag};if(n.tag==="compact"){let f=r(n.value);return f.type==="void"?{type:"compact",isBig:null}:{type:"compact",isBig:Number(f.value.slice(1))>32}}return{type:n.tag}});return r};var m=ne(require("@polkadot-api/substrate-bindings"));var B=(e,o,u)=>(l,c,t,...r)=>{let{id:a}=l;if(c.has(a))return c.get(a);if(t.has(a)){let i=o(()=>c.get(a),l,...r);return c.set(a,i),i}t.add(a);let n=e(l,c,t,...r);return t.delete(a),c.has(a)&&(n=u(n,c.get(a),l,...r)),c.set(a,n),n};var P=require("@polkadot-api/utils"),ae=m.Bin(),ue=(e,o,u,l)=>{if(e.type==="primitive")return m[e.value];if(e.type==="void")return m._void;if(e.type==="AccountId32")return l;if(e.type==="AccountId20")return m.ethAccount;if(e.type==="compact")return m.compact;if(e.type==="bitSequence")return m.bitSequence;let c=d=>_(d,o,u,l),t=(d,p)=>{let s=c(d);return p?m.Vector(s,p):m.Vector(s)},r=d=>m.Tuple(...d.map(c)),a=d=>{let p=Object.fromEntries(Object.entries(d).map(([s,y])=>[s,c(y)]));return m.Struct(p)};if(e.type==="sequence"&&e.value.type==="primitive"&&e.value.value==="u8")return ae;if(e.type==="array")return e.value.type==="primitive"&&e.value.value==="u8"?m.Bin(e.len):t(e.value,e.len);if(e.type==="sequence")return t(e.value);if(e.type==="tuple")return r(e.value);if(e.type==="struct")return a(e.value);if(e.type==="option")return m.Option(c(e.value));if(e.type==="result")return m.Result(c(e.value.ok),c(e.value.ko));let n=Object.values(e.value).map(d=>{switch(d.type){case"void":return m._void;case"lookupEntry":return c(d.value);case"tuple":return r(d.value);case"struct":return a(d.value);case"array":return t(d.value,d.len)}}),i=Object.fromEntries(Object.keys(e.value).map((d,p)=>[d,n[p]])),b=Object.values(e.value).map(d=>d.idx);return b.every((d,p)=>d===p)?m.Variant(i):m.Variant(i,b)},_=B(ue,m.Self,e=>e),se=e=>{let o=e.lookup,u=A(o),l=m.AccountId(),c=new Map,t=s=>_(u(s),c,new Set,l),r=e.pallets.find(s=>s.name==="System")?.constants.find(s=>s.name==="SS58Prefix"),a;if(r)try{let s=t(r.type).dec(r.value);typeof s=="number"&&(a=s,l=m.AccountId(s))}catch{}let n=new Map,i=(s,y)=>{let g=n.get(s);g||n.set(s,g=m.Storage(s));let v=e.pallets.find(w=>w.name===s).storage.items.find(w=>w.name===y),h=(w,...I)=>{let D=g(...I);return{...D,len:w,fallback:v.modifier===1?D.dec(v.fallback):void 0}};if(v.type.tag==="plain")return h(0,y,t(v.type.value).dec);let{key:S,value:L,hashers:C}=v.type.value,Q=t(L),x=C.map(w=>m[w.tag]),X=x.length===1?[[t(S),x[0]]]:u(S).value.map((w,I)=>[t(w.id),x[I]]);return h(x.length,y,Q.dec,...X)},b=s=>{switch(s.type){case"void":return m._void;case"lookupEntry":return t(s.value.id);case"tuple":return m.Tuple(...Object.values(s.value).map(y=>t(y.id)));case"struct":return m.Struct((0,P.mapObject)(s.value,y=>t(y.id)));case"array":return m.Vector(t(s.value.id),s.len)}},f=(s,y)=>{let g=e.pallets.find(v=>v.name===s).constants.find(v=>v.name===y);return t(g.type)},d=s=>(y,g)=>{let v=e.pallets.find(L=>L.name===y),h=u(v[s]);if(h.type!=="enum")throw null;let S=h.value[g];return{location:[v.index,S.idx],codec:b(h.value[g])}},p=(s,y)=>{let g=e.apis.find(v=>v.name===s)?.methods.find(v=>v.name===y);if(!g)throw null;return{args:m.Tuple(...g.inputs.map(v=>t(v.type))),value:t(g.output)}};return{buildDefinition:t,buildStorage:i,buildEvent:d("events"),buildError:d("errors"),buildRuntimeCall:p,buildCall:d("calls"),buildConstant:f,ss58Prefix:a}};var G=require("@polkadot-api/substrate-bindings");function W(e,o){let u=new Map,l=new Set,c=(t,r)=>{u.has(t)||u.set(t,{entry:e(t),backRefs:new Set,refs:new Set}),u.has(r)||u.set(r,{entry:e(r),backRefs:new Set,refs:new Set}),u.get(t).refs.add(r),u.get(r).backRefs.add(t)};for(let t=0;t<o;t++){let r=e(t);if(t!==r.id&&c(t,r.id),!l.has(r.id)){switch(l.add(r.id),r.type){case"array":case"option":case"sequence":c(r.id,r.value.id);break;case"enum":Object.values(r.value).forEach(a=>{switch(a.type){case"array":case"lookupEntry":c(r.id,a.value.id);break;case"struct":case"tuple":Object.values(a.value).forEach(n=>c(r.id,n.id));break}});break;case"result":c(r.id,r.value.ok.id),c(r.id,r.value.ko.id);break;case"struct":case"tuple":Object.values(r.value).forEach(a=>c(r.id,a.id));break}u.has(r.id)||u.set(r.id,{backRefs:new Set,refs:new Set,entry:r})}}return u}var O=new WeakMap;function M(e,o,u,l){if(u.has(e))return;let c=o.get(e);u.set(e,c),l.set(e,u),c.refs.forEach(t=>M(t,o,u,l)),c.backRefs.forEach(t=>M(t,o,u,l))}function z(e,o){O.has(o)||O.set(o,new Map);let u=O.get(o);if(u.has(e))return u.get(e);let l=new Map;return M(e,o,l,u),l}function F(e){let o=new Map,u=0,l=[],c=[];function t(r){let a={index:u,lowLink:u,onStack:!0};o.set(r,a),u++,l.push(r);let n=e.get(r).refs;for(let i of n){let b=o.get(i);b?b.onStack&&(a.lowLink=Math.min(a.lowLink,b.index)):(t(i),a.lowLink=Math.min(a.lowLink,o.get(i).lowLink))}if(a.lowLink===a.index){let i=new Set,b=-1;do b=l.pop(),o.get(b).onStack=!1,i.add(b);while(b!==r);i.size>1&&c.push(i)}}for(let r of e.keys())o.has(r)||t(r);return c}function N(e){let o=e,u=new Set(o.map((t,r)=>r)),l=new Map(o.map((t,r)=>[r,new Set]));o.forEach((t,r)=>{o.slice(r+1).forEach((a,n)=>{let i=n+r+1;new Set([...t,...a]).size!==t.size+a.size&&(l.get(r).add(i),l.get(i).add(r))})});let c=[];for(;u.size;){let t=new Set,r=[u.values().next().value];for(;r.length;){let a=r.pop();if(!u.has(a))continue;u.delete(a),o[a].forEach(i=>t.add(Number(i))),l.get(a).forEach(i=>r.push(i))}c.push(t)}return c}var K=new TextEncoder,ie=K.encode.bind(K),k=e=>{let o=new Uint8Array(e.length*8),u=new DataView(o.buffer);for(let l=0;l<e.length;l++)u.setBigUint64(l*8,e[l]);return(0,G.h64)(o)},U=e=>k(e.map(o=>(0,G.h64)(ie(o)))),V={primitive:0n,vector:1n,tuple:2n,struct:3n,option:4n,result:5n,enum:6n,void:7n},E={undefined:0n,number:1n,string:2n,bigint:3n,boolean:4n,bitSequence:5n,byteSequence:6n,accountId32:7n,accountId20:8n},ce={bool:E.boolean,char:E.string,str:E.string,u8:E.number,u16:E.number,u32:E.number,u64:E.bigint,u128:E.bigint,u256:E.bigint,i8:E.number,i16:E.number,i32:E.number,i64:E.bigint,i128:E.bigint,i256:E.bigint},T=(e,o,u)=>{let l=Object.entries(o).sort(([r],[a])=>r.localeCompare(a)),c=U(l.map(([r])=>r)),t=k(l.map(([,r])=>u(r)));return k([e,c,t])},H=(e,o)=>{if(e.type==="primitive")return k([V.primitive,ce[e.value]]);if(e.type==="void")return k([V.void]);if(e.type==="compact")return k([V.primitive,E[e.isBig||e.isBig===null?"bigint":"number"]]);if(e.type==="bitSequence")return k([V.primitive,E.bitSequence]);if(e.type==="AccountId32")return k([V.primitive,E.accountId32]);if(e.type==="AccountId20")return k([V.primitive,E.accountId20]);let u=(t,r)=>{let a=o(t);return k(r!==void 0?[V.vector,a,BigInt(r)]:[V.vector,a])};if(e.type==="array"){let t=e.value;return t.type==="primitive"&&t.value==="u8"?k([V.primitive,E.byteSequence,BigInt(e.len)]):u(t,e.len)}if(e.type==="sequence"){let t=e.value;return t.type==="primitive"&&t.value==="u8"?k([V.primitive,E.byteSequence]):u(t)}let l=t=>k([V.tuple,...t.map(o)]),c=t=>T(V.struct,t,o);return e.type==="tuple"?l(e.value):e.type==="struct"?c(e.value):e.type==="option"?k([V.option,o(e.value)]):e.type==="result"?k([V.result,o(e.value.ok),o(e.value.ko)]):T(V.enum,e.value,t=>{if(t.type==="lookupEntry")return o(t.value);switch(t.type){case"void":return k([V.void]);case"tuple":return l(t.value);case"struct":return c(t.value);case"array":return u(t.value,t.len)}})},le=(e,o)=>{let u=t=>{let r=new Set,a=Array.from(t);for(;a.length;){let n=a.pop();r.has(n)||(r.add(n),o.get(n)?.refs.forEach(i=>a.push(i)))}return Array.from(r)},l=new Array;function c(t){l.includes(t)||(e.filter(a=>a!==t&&u(t).some(n=>a.has(n))).forEach(a=>c(a)),l.includes(t))||l.push(t)}return e.forEach(t=>c(t)),l};function J(e,o,u,l){let c=new Map([...e].map(a=>[a,0n])),t=new Map,r=(a,n=!0)=>{if(!n&&(c.has(a.id)||u.has(a.id)))return c.get(a.id)??u.get(a.id);let i=H(a,b=>r(b,!1));return e.has(a.id)?t.set(a.id,i):u.set(a.id,i),i};for(let a=0;a<o;a++)e.forEach(n=>r(l.get(n).entry)),e.forEach(n=>c.set(n,t.get(n)));return c}function pe(e,o){let u=e.reduce((n,i)=>Math.max(n,i.size),0),l=new Set([...o.values()].map(n=>n.entry.id)),c=J(l,u,new Map,o),t=new Map;for(let n of l){let i=c.get(n);if(i==null)throw new Error("Unreachable");t.has(i)||t.set(i,[]),t.get(i).push(n)}let r=[...t.entries()].filter(([,n])=>n.length>1),a={};return r.forEach(([,n])=>{n.forEach(i=>a[i]=n)}),a}var de=(e,o,u)=>{if(o.has(e.id))return o.get(e.id);let l=z(e.id,u),c=F(l),t=N(c).filter(i=>!o.has(i.values().next().value)),r=pe(t,l);le(t.filter(i=>i.size>1),l).forEach(i=>{if(o.has(i.values().next().value))return;let b=J(i,i.size,o,u);i.forEach(f=>{let d=b.get(f);f in r?r[f].forEach(p=>o.set(p,d)):o.set(f,d)})});let n=i=>o.has(i.id)?o.get(i.id):H(i,n);return n(e)},me=e=>{let o=e.lookup,u=A(o),l=W(u,o.length),c=new Map,t=p=>de(u(p),c,l),r=(p,s)=>{try{let y=e.pallets.find(L=>L.name===p).storage.items.find(L=>L.name===s);if(y.type.tag==="plain")return t(y.type.value);let{key:g,value:v}=y.type.value,h=t(v),S=t(g);return k([h,S])}catch{return null}},a=(p,s)=>{try{let y=e.apis.find(S=>S.name===p)?.methods.find(S=>S.name===s);if(!y)throw null;let g=U(y.inputs.map(S=>S.name)),v=k(y.inputs.map(S=>t(S.type))),h=t(y.output);return k([g,v,h])}catch{return null}},n=p=>{if(p.type==="void")return k([0n]);if(p.type==="tuple"){let s=Object.values(p.value).map(y=>t(y.id));return k([V.tuple,...s])}return p.type==="array"?k([V.vector,t(p.value.id),BigInt(p.len)]):T(V.struct,p.value,s=>t(s.id))},i=p=>T(V.tuple,p.value,s=>t(s.id)),b=p=>(s,y)=>{try{let g=e.pallets.find(S=>S.name===s),v=u(g[p]);if(t(v.id),v.type!=="enum")throw null;let h=v.value[y];return h.type==="lookupEntry"?t(h.value.id):n(h)}catch{return null}},f=(p,s)=>{try{let y=e.pallets.find(g=>g.name===p).constants.find(g=>g.name===s);return t(y.type)}catch{return null}},d=p=>(...s)=>p(...s)?.toString(32)??null;return{buildDefinition:d(t),buildRuntimeCall:d(a),buildStorage:d(r),buildCall:d(b("calls")),buildEvent:d(b("events")),buildError:d(b("errors")),buildConstant:d(f),buildComposite:d(n),buildNamedTuple:d(i),getAllGeneratedChecksums:()=>Array.from(c.values()).map(p=>p.toString(32))}};
//# sourceMappingURL=index.js.map
"use strict";var f=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var O=(t,e,n)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var w=(t,e)=>{for(var n in e)f(t,n,{get:e[n],enumerable:!0})},b=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $(e))!y.call(t,s)&&s!==n&&f(t,s,{get:()=>e[s],enumerable:!(r=k(e,s))||r.enumerable});return t};var N=t=>b(f({},"__esModule",{value:!0}),t);var T=(t,e,n)=>(O(t,typeof e!="symbol"?e+"":e,n),n);var _={};w(_,{logsProvider:()=>R,withLogsRecorder:()=>P});module.exports=N(_);var g=class{constructor(...e){T(this,"first");T(this,"last");e.length!==0&&e.forEach(n=>this.push(n))}push(e){let n={value:e};this.last===void 0?(this.last=n,this.first=this.last):(this.last.next=n,this.last=n)}pop(){let e=this.first?.value;return this.first&&(this.first=this.first.next,this.first||(this.last=void 0)),e}peek(){return this.first?.value}};var m=">>",x="<<";var Q=t=>{let e=new Map,n="",r=-1;for(let s=0;s<t.length;s++){let[,l,c,u,a]=t[s].match(/^(\d*)-(.{24})-(.{2})-(.*)$/),o=Number(l);r+=c===n?0:1,n=c;let d=e.get(o)??[];e.set(o,d),d.push({clientId:o,tick:r,type:u,msg:a})}return e},v=t=>{let e='TaggedTransactionQueue_validate_transaction","',n=t.lastIndexOf(e)+e.length+4,r=t.indexOf('"',n+1);return t.substring(n,r-64)},R=t=>{let e=1,n=Q(t[t.length-1]?t:t.slice(0,-1));return r=>{let s=e++,l=n.get(s),c=new g,u=0,a=new Map,o=async()=>{if(c.peek())for(;u<l.length&&d!==void 0;){let i=l[u];if(a.forEach((p,h)=>{i.msg=i.msg.replace(h,p)}),i.type===m){if(!c.peek()){d=setTimeout(o,100);break}let p=c.pop();if(i.msg.includes("TaggedTransactionQueue_validate_transaction")&&p?.includes("TaggedTransactionQueue_validate_transaction")&&(a.set(v(i.msg),v(p)),a.forEach((h,I)=>{i.msg=i.msg.replace(I,h)})),p!==i.msg)throw console.log(`recieved: "${p}"`),console.log(`expected: "${i.msg}"`),new Error("unexpected messaged was received")}else r(i.msg),await Promise.resolve();u++}},d=setTimeout(o,200);return{send:i=>{c.push(i)},disconnect:()=>{clearTimeout(d),d=void 0}}}};var P=(t,e)=>{let n=1,r,s="",l=()=>{s=new Date().toISOString(),r=setTimeout(l,0)};return c=>{let u=n++;l();let a=e(o=>{t(`${u}-${s}-${x}-${o}`),c(o)});return{...a,send:o=>{t(`${u}-${s}-${m}-${o}`),a.send(o)},disconnect(){clearTimeout(r),a.disconnect()}}}};
//# sourceMappingURL=index.js.map
"use strict";var se=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Je=Object.prototype.hasOwnProperty;var me=(e,t)=>{for(var r in t)se(e,r,{get:t[r],enumerable:!0})},Ze=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ke(t))!Je.call(e,o)&&o!==r&&se(e,o,{get:()=>t[o],enumerable:!(n=qe(t,o))||n.enumerable});return e};var Ye=e=>Ze(se({},"__esModule",{value:!0}),e);var Ct={};me(Ct,{AccountId:()=>B.AccountId,Binary:()=>B.Binary,Enum:()=>B.Enum,FixedSizeBinary:()=>B.FixedSizeBinary,_Enum:()=>B._Enum,createClient:()=>xt});module.exports=Ye(Ct);var Le=require("@polkadot-api/observable-client"),Ge=require("@polkadot-api/substrate-client"),L=require("rxjs");var j=require("rxjs"),ue=(e,t,r,n)=>{let{isCompatible:o,compatibleRuntime$:p}=n(u=>u.checksumBuilder.buildConstant(e,t)),c=()=>new Error(`Incompatible runtime entry Constant(${e}.${t})`),b=new WeakMap,s=u=>{if(b.has(u))return b.get(u);let l=u.metadata.pallets.find(i=>i.name===e)?.constants.find(i=>i.name===t),m=u.dynamicBuilder.buildConstant(e,t).dec(l.value);return b.set(u,m),m};return Object.assign(u=>{if(u){if(!o(u))throw c();return s(u._getCtx())}return(0,j.firstValueFrom)(p(r,null,c).pipe((0,j.map)(s)))},{isCompatible:o})};var z=require("rxjs");var q=require("rxjs"),ye=(0,q.share)({connector:()=>new q.ReplaySubject(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0});var be=require("@polkadot-api/utils"),de=require("rxjs");function N(e,t){return new Promise((r,n)=>{let o=null,p=!1,c=t?()=>{o?.unsubscribe(),n(new be.AbortError)}:de.noop;o=e.subscribe({next:b=>{r(b),o?.unsubscribe(),p=!0},error:b=>{t?.removeEventListener("abort",c),n(b)},complete:()=>{t?.removeEventListener("abort",c),n(new Error("Observable completed without emitting"))}}),p||t?.addEventListener("abort",c)})}var K=require("rxjs"),fe=(e,t=1/0)=>r=>new K.Observable(n=>{let o,p=new Map,c=new Map,b=new Map,s=0,y=0,u=0,a=()=>{let l=p.get(y);if(!l){c.size===0&&(typeof o>"u"||o.closed)&&n.complete();return}let m=y++;p.delete(m),u!==m&&b.set(m,[]),c.set(m,l.subscribe({next(i){u===m?n.next(i):b.get(m).push(i)},complete(){if(c.delete(m),m===u)for(u++;b.has(u)&&(b.get(u).forEach(i=>n.next(i)),b.delete(u),!c.has(u));)u++;a()},error(i){n.error(i)}}))};return o=r.subscribe({next(l){let m=s++;p.set(m,(0,K.defer)(()=>e(l,m))),c.size<t&&a()},error(l){n.error(l)},complete(){c.size===0&&n.complete()}}),()=>{c.forEach(l=>l.unsubscribe()),o.unsubscribe(),p.clear(),b.clear()}});var J=require("rxjs"),ge=(e,t)=>r=>new J.Observable(n=>{let o=new Array,p=!1,c=s=>{let y=new J.Subscription;o.push(y),o.length>t&&(o[0].unsubscribe(),o=o.slice(1));let u=e(s).subscribe({next(a){let l=o.indexOf(y);o.slice(0,l).forEach(m=>m.unsubscribe()),o=o.slice(l),n.next(a)},error(a){n.error(a)},complete(){let a=o.indexOf(y);o.splice(a,1),o.length===0&&p&&n.complete()}});y.add(u)},b=r.subscribe({next(s){c(s)},error(s){n.error(s)},complete(){o.length===0&&n.complete(),p=!0}});return()=>{b.unsubscribe(),o.forEach(s=>s.unsubscribe())}});var xe=require("rxjs"),he={},Ce=e=>t=>new xe.Observable(r=>{let n=he,o=t.subscribe({next(p){r.next(n=p)},error(p){r.error(p)},complete(){n===he?r.complete():o=e(n).subscribe(r)}});return()=>{o.unsubscribe()}});var ve=(e,t,r,n)=>{let{isCompatible:o,withCompatibleRuntime:p}=n(a=>a.checksumBuilder.buildEvent(e,t)),c=()=>new Error(`Incompatible runtime entry Event(${e}.${t})`),b=r.finalized$.pipe(p(r,a=>a.hash,c),fe(([a])=>r.eventsAt$(a.hash).pipe((0,z.map)(l=>l.filter(i=>i.event.type===e&&i.event.value.type===t).map(i=>({meta:{phase:i.phase,block:a},payload:i.event.value.value}))))),ye);return{watch:a=>b.pipe((0,z.mergeMap)(l=>a?l.filter(m=>a(m.payload)):l)),pull:()=>(0,z.firstValueFrom)(b),filter:a=>a.filter(l=>l.type===e&&l.value.type===t).map(l=>l.value.value),isCompatible:o}};var A=require("rxjs");var ae=class e{constructor(t,r,n){this._ctx=t;this._checksums=r;this._descriptors=n}static _create(t,r,n){return new e(t,r,n)}_getCtx(){return this._ctx}_getPalletChecksum(t,r,n){return this._checksums[this._descriptors[t][r][n]]}_getApiChecksum(t,r){return this._checksums[this._descriptors.apis[t][r]]}},Ee=(e,t,r)=>{let n=(0,A.connectable)((0,A.combineLatest)([r.runtime$,e,t]).pipe((0,A.map)(([p,c,b])=>p?ae._create(p,c,b):null)),{connector:()=>new A.ReplaySubject(1)});n.connect();let o=n.pipe((0,A.filter)(p=>!!p));return o.latest=()=>(0,A.firstValueFrom)(o),o},_=(e,t)=>r=>{function n(s){return r(s._getCtx())===t(s)}let o=s=>s?n(s):e.latest().then(n),p=async()=>{let s=await e.latest();return y=>r(y)===t(s)};return{isCompatible:o,waitChecksums:p,withCompatibleRuntime:(s,y,u)=>a=>(0,A.combineLatest)([a.pipe(s.withRuntime(y)),p()]).pipe((0,A.map)(([[l,m],i])=>{if(!i(m))throw u();return[l,m]})),compatibleRuntime$:(s,y,u)=>(0,A.combineLatest)([s.getRuntimeContext$(y),p()]).pipe((0,A.map)(([a,l])=>{if(!l(a))throw u();return a}))}};var Se=require("@polkadot-api/utils"),Z=require("rxjs"),Qe=e=>typeof e!="object"?!1:Object.keys(e).every(t=>t==="at"&&typeof e.at=="string"||t==="signal"&&e.signal instanceof AbortSignal),ke=(e,t,r,n)=>{let{isCompatible:o,compatibleRuntime$:p}=n(y=>y.checksumBuilder.buildRuntimeCall(e,t)),c=`${e}_${t}`,b=()=>new Error(`Incompatible runtime entry RuntimeCall(${c})`);return Object.assign((...y)=>{let u=y[y.length-1],a=Qe(u),{signal:l,at:m}=a?u:{},i=m??null,C=p(r,i,b).pipe((0,Z.mergeMap)(T=>{let E=T.dynamicBuilder.buildRuntimeCall(e,t);return r.call$(i,c,(0,Se.toHex)(E.args.enc(y))).pipe((0,Z.map)(E.value.dec))}));return N(C,l)},{isCompatible:o})};var $=require("rxjs"),Te=require("@polkadot-api/observable-client"),Ae=e=>typeof e!="object"?!1:Object.keys(e).every(t=>t==="at"&&typeof e.at=="string"||t==="signal"&&e.signal instanceof AbortSignal),Oe=(e,t,r,n)=>{let o=e==="System"&&t==="Number",{isCompatible:p,waitChecksums:c,withCompatibleRuntime:b}=n(i=>i.checksumBuilder.buildStorage(e,t)),s=()=>new Error(`Incompatible runtime entry Storage(${e}.${t})`),y=i=>new Error(`Invalid Arguments calling ${e}.${t}(${i})`),u=(...i)=>{let C=i[i.length-1],T=C==="best"||C==="finalized"?i.slice(0,-1):i;return o?r.bestBlocks$.pipe((0,$.map)(E=>E.at(C==="best"?0:-1).number),(0,$.distinctUntilChanged)()):r[C==="best"?"best$":"finalized$"].pipe((0,$.debounceTime)(0),b(r,E=>E.hash,s),ge(([E,P])=>{let w=P.dynamicBuilder.buildStorage(e,t);return r.storage$(E.hash,"value",()=>w.enc(...T)).pipe((0,$.map)(f=>({val:f,codecs:w})))},4),(0,$.distinctUntilChanged)((E,P)=>E.val===P.val),(0,$.map)(({val:E,codecs:P})=>E===null?P.fallback:P.dec(E)))},a=async(...i)=>{let C=i[i.length-1],T=Ae(C),{signal:E,at:P}=T?C:{},w=P??null,f;if(o)f=r.bestBlocks$.pipe((0,$.map)(d=>w==="finalized"||!w?d.at(-1):w==="best"?d.at(0):d.find(g=>g.hash===w)),(0,$.map)(d=>{if(!d)throw new Te.NotBestBlockError;return d.number}),(0,$.distinctUntilChanged)());else{let d=await c();f=r.storage$(w,"value",g=>{if(!d(g))throw s();let h=g.dynamicBuilder.buildStorage(e,t),v=i.length===h.len?i:i.slice(0,-1);if(i!==v&&!T)throw y(i);return h.enc(...v)},null,(g,h)=>{let v=h.dynamicBuilder.buildStorage(e,t);return g===null?v.fallback:v.dec(g)})}return N(f,E)};return{isCompatible:p,getValue:a,getValues:(i,C)=>Promise.all(i.map(T=>a(...C?[...T,C]:T))),getEntries:async(...i)=>{let C=i[i.length-1],T=Ae(C),{signal:E,at:P}=T?C:{},w=P??null,f=await c(),d=r.storage$(w,"descendantsValues",g=>{if(!f(g))throw s();let h=g.dynamicBuilder.buildStorage(e,t);if(i.length>h.len)throw y(i);let v=i.length>0&&T?i.slice(0,-1):i;if(i.length===h.len&&v===i)throw y(i);return h.enc(...v)},null,(g,h)=>{let v=h.dynamicBuilder.buildStorage(e,t);return g.map(({key:G,value:ie})=>({keyArgs:v.keyDecoder(G),value:v.dec(ie)}))});return N(d,E)},watchValue:u}};var k=require("@polkadot-api/substrate-bindings"),H=require("@polkadot-api/utils"),S=require("rxjs"),Ue=require("@polkadot-api/signer");var I=require("rxjs");var $e=require("@polkadot-api/substrate-bindings"),we=require("rxjs");var F=require("rxjs"),D=require("@polkadot-api/substrate-bindings"),Y=require("@polkadot-api/metadata-builders"),Pe=require("@polkadot-api/utils"),O=new Uint8Array,Xe=(0,D.Storage)("System")("BlockHash",F.noop,[D.u32,D.Twox64Concat]).enc(0),Q=e=>e.chainHead.storage$(e.at,"value",()=>Xe,null).pipe((0,F.map)(t=>(0,Pe.fromHex)(t))),X=(e,t)=>{let r=(0,Y.getLookupFn)(t.lookup),n=(0,Y.getDynamicBuilder)(t),o=t.pallets.find(s=>s.name==="System").constants.find(s=>s.name==="Version"),p=r(o.type),c=n.buildDefinition(o.type).dec;if(p.type!=="struct")throw new Error("not a struct");let b=n.buildDefinition(p.value[e].id).enc;return(0,F.of)(b(c(o.value)[e]))};var Re=e=>(0,we.of)({value:$e.compactBn.enc(e),additionalSigned:O});var ee=require("rxjs"),M=require("@polkadot-api/substrate-bindings"),Be=require("@polkadot-api/utils");function et(e){let t=0;for(;!(e&1);)t++,e>>=1;return t}var tt=(0,M.enhanceEncoder)((0,M.Bytes)(2).enc,e=>{let t=Math.max(e.period>>12,1),r=Math.min(Math.max(et(e.period)-1,1),15),n=e.phase/t<<4;return M.u16.enc(r|n)}),nt=new Uint8Array([0]),Ie=(e,t)=>{if(!e)return Q(t).pipe((0,ee.map)(o=>({additionalSigned:o,value:nt})));let{period:r,blockNumber:n}=e;return(0,ee.of)({additionalSigned:(0,Be.fromHex)(t.at),value:tt({period:r,phase:n%r})})};var Ve=require("rxjs"),V=require("@polkadot-api/substrate-bindings");var rt=(0,V.Struct)({tip:V.compact,asset:(0,V.Option)((0,V.Bytes)(1/0))}).enc,He=(e,t)=>(0,Ve.of)({value:rt({tip:e,asset:t}),additionalSigned:O});var le={};me(le,{CheckGenesis:()=>ot,CheckMetadataHash:()=>it,CheckNonce:()=>at,CheckSpecVersion:()=>lt,CheckTxVersion:()=>pt,getNonce:()=>re});var ze=require("rxjs");var ot=e=>Q(e).pipe((0,ze.map)(t=>({value:O,additionalSigned:t})));var _e=require("rxjs"),it=()=>(0,_e.of)({value:Uint8Array.from([0]),additionalSigned:Uint8Array.from([0])});var te=require("rxjs"),R=require("@polkadot-api/substrate-bindings");var ne=require("@polkadot-api/utils"),Fe="AccountNonceApi_account_nonce",st={1:R.u8.dec,2:R.u16.dec,4:R.u32.dec,8:R.u64.dec},re=e=>(0,te.of)({value:R.compact.enc(e),additionalSigned:O}),at=e=>e.chainHead.call$(e.at,Fe,(0,ne.toHex)(e.from)).pipe((0,te.mergeMap)(t=>{let r=(0,ne.fromHex)(t),n=st[r.length];if(!n)throw new Error(`${Fe} retrieved wrong data`);return re(n(r))}));var De=require("rxjs");var lt=({metadata:e})=>X("spec_version",e).pipe((0,De.map)(t=>({additionalSigned:t,value:O})));var Me=require("rxjs");var pt=({metadata:e})=>X("transaction_version",e).pipe((0,Me.map)(t=>({additionalSigned:t,value:O})));var pe=require("@polkadot-api/substrate-bindings");var We=(e,t,r,n,o={})=>e.getRuntimeContext$(n.hash).pipe((0,I.take)(1),(0,I.mergeMap)(p=>{let c={metadata:p.metadata,chainHead:e,callData:r,at:n.hash,from:t.publicKey},b=o.mortality?o.mortality.mortal?{period:o.mortality.period,blockNumber:n.number}:void 0:{period:64,blockNumber:n.number};return(0,I.combineLatest)(p.metadata.extrinsic.signedExtensions.map(({identifier:s,type:y,additionalSigned:u})=>{if(s==="CheckMortality")return Ie(b,c);if(s==="ChargeTransactionPayment")return Re(o.tip??0n);if(s==="ChargeAssetTxPayment")return He(o.tip??0n,o.asset);if(s==="CheckNonce"&&"nonce"in o)return re(o.nonce);let a=le[s];if(!a){if(p.dynamicBuilder.buildDefinition(y)===pe._void&&p.dynamicBuilder.buildDefinition(u)===pe._void)return(0,I.of)({value:O,additionalSigned:O});throw new Error(`Unsupported signed-extension: ${s}`)}return a(c)})).pipe((0,I.mergeMap)(s=>t.sign(r,Object.fromEntries(p.metadata.extrinsic.signedExtensions.map(({identifier:y},u)=>[y,{identifier:y,...s[u]}])),p.metadataRaw,n.number)))}));var Ne=require("@polkadot-api/substrate-bindings"),x=require("rxjs");var oe=require("@polkadot-api/utils"),ct=e=>(0,oe.toHex)((0,Ne.Blake2256)((0,oe.fromHex)(e))),mt=(e,t)=>new x.Observable(r=>{let n=new Map,o,p,c=()=>{let s=o.best,y=n.get(s);for(;!y;){let l=o.blocks.get(s);if(!l)break;y=n.get(s=l.parent)}if(!y)return;let u=o.blocks.get(y.hash).number<=o.blocks.get(o.finalized).number,a=y.found.type;if(a&&typeof p=="object"&&p.hash===y.hash){u&&r.complete();return}r.next(p=a?{hash:y.hash,...y.found}:y.found.isValid),u&&(a?r.complete():y.found.isValid||r.error(new Error("Invalid")))},b=t.pipe((0,x.distinctUntilChanged)((s,y)=>s.finalized===y.finalized&&s.best===y.best)).subscribe({next:s=>{o=s,n.size!==0&&c()},error(s){r.error(s)}});return b.add(e.subscribe({next:s=>{n.set(s.hash,s),c()},error(s){r.error(s)}})),b}).pipe((0,x.distinctUntilChanged)((r,n)=>r===n)),ut=(e,t)=>{let r=e.filter(p=>p.phase.type==="ApplyExtrinsic"&&p.phase.value===t).map(p=>p.event),n=r[r.length-1];return{ok:n.type==="System"&&n.value.type==="ExtrinsicSuccess",events:r}},W=(e,t,r,n,o=!1)=>{let p=ct(r),c=(a,l)=>({type:a,txHash:p,...l}),s=e.pinnedBlocks$.pipe((0,x.take)(1),(0,x.map)(a=>a.blocks.get(n)?.hash??a.finalized)).pipe((0,x.mergeMap)(a=>e.validateTx$(a,r).pipe((0,x.filter)(l=>!l),(0,x.map)(()=>{throw new Error("Invalid")})))),y=new x.Observable(a=>{let l=e.trackTx$(r).subscribe(a);return l.add(t(r).subscribe({error(m){a.error(m)}})),l}),u=mt(y,e.pinnedBlocks$).pipe((0,x.map)(a=>a===!0||a===!1?c("txBestBlocksState",{found:!1,isValid:a}):c("txBestBlocksState",{found:!0,block:{index:a.index,hash:a.hash},...ut(a.events,a.index)})));return(0,x.concat)(o?(0,x.of)(c("signed",{})):x.EMPTY,s,(0,x.of)(c("broadcasted",{})),u.pipe(Ce(({found:a,type:l,...m})=>a?(0,x.of)(c("finalized",m)):x.EMPTY)))},U=async(e,t,r,n)=>(0,x.lastValueFrom)(W(e,t,r,n)).then(o=>{if(o.type!=="finalized")throw null;let p={...o};return delete p.type,p});var yt=(0,k.AccountId)().enc,bt=(0,k.Tuple)(k.compact,k.compact,k.u8,k.u128).dec,dt=e=>bt(e)[3],ft=new Uint8Array(64),gt=()=>ft,ce=(e,t,r,n,o,p)=>{let{isCompatible:c,compatibleRuntime$:b}=p(u=>u.checksumBuilder.buildCall(e,t)),s=()=>new Error(`Incompatible runtime entry Tx(${e}.${t})`);return Object.assign(u=>{let a=({dynamicBuilder:f,asset:[d,g]},h,v={})=>{let G=v;if(v.asset){if(r!==g)throw new Error("Incompatible runtime asset");G={...v,asset:d(v.asset)}}let{location:ie,codec:je}=f.buildCall(e,t);return{callData:k.Binary.fromBytes((0,H.mergeUint8)(new Uint8Array(ie),je.enc(h))),options:G}},l=(f,d={})=>b(n,null,s).pipe((0,S.map)(g=>a(g,f,d))),m=f=>{if(!f)return(0,S.firstValueFrom)(l(u).pipe((0,S.map)(d=>d.callData)));if(!c(f))throw s();return a(f._getCtx(),u).callData},i=(f,{...d},g)=>l(u,d).pipe((0,S.mergeMap)(({callData:h,options:v})=>We(n,f,h.asBytes(),g,v))),C=(f,{at:d,...g}={})=>(!d||d==="finalized"?n.finalized$:d==="best"?n.best$:n.bestBlocks$.pipe((0,S.map)(h=>h.find(v=>v.hash===d)))).pipe((0,S.take)(1),(0,S.mergeMap)(h=>h?i(f,g,h).pipe((0,S.map)(v=>({tx:(0,H.toHex)(v),block:h}))):(0,S.throwError)(()=>new Error(`Uknown block ${d}`)))),T=(f,d)=>(0,S.firstValueFrom)(C(f,d)).then(g=>g.tx),E=(f,d)=>(0,S.firstValueFrom)(C(f,d)).then(({tx:g,block:h})=>U(n,o,g,h.hash)),P=(f,d)=>C(f,d).pipe((0,S.mergeMap)(({tx:g,block:h})=>W(n,o,g,h.hash,!0)));return{getEstimatedFees:async(f,d)=>{let g=(0,Ue.getPolkadotSigner)(f instanceof Uint8Array?f:yt(f),"Sr25519",gt),h=(0,H.fromHex)(await T(g,d)),v=(0,H.toHex)((0,H.mergeUint8)(h,k.u32.enc(h.length)));return(0,S.firstValueFrom)(n.call$(null,"TransactionPaymentApi_query_info",v).pipe((0,S.map)(dt)))},decodedCall:{type:e,value:(0,k.Enum)(t,u)},getEncodedData:m,sign:T,signSubmitAndWatch:P,signAndSubmit:E}},{isCompatible:c})};var ht=(e,t,r)=>{let n=Ee(e.checksums,e.descriptors,t),o={},p=l=>new Proxy(o,{get(m,i){return l(i)}}),c=l=>{let m={};return p(i=>(m[i]||(m[i]={}),p(C=>(m[i][C]||(m[i][C]=l(i,C)),m[i][C]))))},b=c((l,m)=>Oe(l,m,t,_(n,i=>i._getPalletChecksum("storage",l,m)))),s=c((l,m)=>ce(l,m,e.asset,t,r,_(n,i=>i._getPalletChecksum("tx",l,m)))),y=c((l,m)=>ve(l,m,t,_(n,i=>i._getPalletChecksum("events",l,m)))),u=c((l,m)=>ue(l,m,t,_(n,i=>i._getPalletChecksum("constants",l,m)))),a=c((l,m)=>ke(l,m,t,_(n,i=>i._getApiChecksum(l,m))));return{query:b,tx:s,event:y,apis:a,constants:u,runtime:n}};function xt(e){let t=(0,Ge.createClient)(e),r=(0,Le.getObservableClient)(t),n=r.chainHead$(),{getChainSpecData:o}=t,p=t.request,{broadcastTx$:c}=r;return{getChainSpecData:o,finalizedBlock$:n.finalized$,getFinalizedBlock:()=>(0,L.firstValueFrom)(n.finalized$),bestBlocks$:n.bestBlocks$,getBestBlocks:()=>(0,L.firstValueFrom)(n.bestBlocks$),watchBlockBody:n.body$,getBlockBody:b=>(0,L.firstValueFrom)(n.body$(b)),getBlockHeader:b=>(0,L.firstValueFrom)(n.header$(b??null)),submit:(...b)=>U(n,c,...b),submitAndWatch:(...b)=>W(n,c,...b),getTypedApi:b=>ht(b,n,c),destroy:()=>{n.unfollow(),r.destroy()},_request:p}}var B=require("@polkadot-api/substrate-bindings");
//# sourceMappingURL=index.js.map